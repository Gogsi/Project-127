<Window x:Class="Project_127.ColorPicker"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:cefSharp="clr-namespace:CefSharp.Wpf;assembly=CefSharp.Wpf"
      xmlns:local="clr-namespace:Project_127"
      mc:Ignorable="d" 
      Height="400" Width="240"
      WindowStyle="ToolWindow"
      ResizeMode="CanMinimize"
      Title="ColorPicker">

    <Grid Height="400" Width="240">
        <cefSharp:ChromiumWebBrowser 
            x:Name="browser" 
            HorizontalAlignment="Right" 
            VerticalAlignment="Bottom" 
            Width="240" Height="400" 
            Margin="0,0,0,0" 
            Address="data:text/html;base64,PGh0bWw+CiAgICA8aGVhZD4KICAgICAgICA8c3R5bGU+CiAgICAgICAgICAgIGNhbnZhcyB7CiAgICAgICAgICAgICAgICBib3JkZXI6IDJweCBzb2xpZCBibGFjazsKICAgICAgICAgICAgfQogICAgICAgICAgICBib2R5IHsKICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICMxMzEyMTg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgI2FscGhhc2xpZGUgewogICAgICAgICAgICAgICAgd2lkdGg6IDIwNHB4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxhYmVsIHsKICAgICAgICAgICAgICAgIHdpZHRoOiAyMnB4OwogICAgICAgICAgICAgICAgY29sb3I6ICNjY2NjY2M7CiAgICAgICAgICAgICAgICBmb250LWZhbWlseTogJ0NvbnNvbGFzJywgJ21vbm9zcGFjZSc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaW5wdXRbdHlwZT0nbnVtYmVyJ10gewogICAgICAgICAgICAgICAgd2lkdGg6IDQ0cHg7CiAgICAgICAgICAgIH0KICAgICAgICA8L3N0eWxlPgogICAgICAgIDxzY3JpcHQ+CiAgICAgICAgICAgIGxldCBodWViYXJpbWFnZTsKICAgICAgICAgICAgbGV0IHNsUWltYWdlOwogICAgICAgICAgICBsZXQgYWNGcmFtZSA9IGZhbHNlOwogICAgICAgICAgICBsZXQgaHVlID0gMTgwOwogICAgICAgICAgICBsZXQgcGh1ZSA9IDA7CiAgICAgICAgICAgIC8vbGV0IHBhbHBoYSA9IDE7CiAgICAgICAgICAgIGxldCBhbHBoYSA9IDE7CiAgICAgICAgICAgIGxldCBzbHh5ID0gWzAsMF07CiAgICAgICAgICAgIGxldCBoc2xhID0gWzAsMCwwLDBdOwogICAgICAgICAgICBsZXQgbW91c2Vkb3duID0gZmFsc2U7CiAgICAgICAgICAgIGxldCBuZXdGcmFtZSA9IGZhbHNlOwogICAgICAgICAgICBmdW5jdGlvbiBmcmFtZSgpIHsKICAgICAgICAgICAgICAgIGlmIChuZXdGcmFtZSl7CiAgICAgICAgICAgICAgICAgICAgdXBkYXRlQ2FudmFzKCk7CiAgICAgICAgICAgICAgICAgICAgbmV3RnJhbWUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAvL2xldCBjb21tT2JqZWN0ID0gbnVsbDsKICAgICAgICAgICAgZnVuY3Rpb24gaHNsYTJyZ2JhKGgsIHMsIGwsIGEpewogICAgICAgICAgICAgICAgbGV0IHIsZyxiOwogICAgICAgICAgICAgICAgbGV0IGMgPSAoMSAtIE1hdGguYWJzKDIgKiBsIC0gMSkpICogczsKICAgICAgICAgICAgICAgIGxldCB4ID0gYyAqICgxIC0gTWF0aC5hYnMoKGggLyA2MCkgJSAyIC0gMSkpOwogICAgICAgICAgICAgICAgbGV0IG0gPSBsIC0gYy8yOwogICAgICAgICAgICAgICAgaWYgKDAgPD0gaCAmJiBoIDwgNjApIHsKICAgICAgICAgICAgICAgICAgICByID0gYzsgZyA9IHg7IGIgPSAwOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICg2MCA8PSBoICYmIGggPCAxMjApIHsKICAgICAgICAgICAgICAgICAgICByID0geDsgZyA9IGM7IGIgPSAwOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICgxMjAgPD0gaCAmJiBoIDwgMTgwKSB7CiAgICAgICAgICAgICAgICAgICAgciA9IDA7IGcgPSBjOyBiID0geDsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoMTgwIDw9IGggJiYgaCA8IDI0MCkgewogICAgICAgICAgICAgICAgICAgIHIgPSAwOyBnID0geDsgYiA9IGM7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKDI0MCA8PSBoICYmIGggPCAzMDApIHsKICAgICAgICAgICAgICAgICAgICByID0geDsgZyA9IDA7IGIgPSBjOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICgzMDAgPD0gaCAmJiBoIDwgMzYwKSB7CiAgICAgICAgICAgICAgICAgICAgciA9IGM7IGcgPSAwOyBiID0geDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHIgPSBNYXRoLnJvdW5kKChyICsgbSkgKiAyNTUpOwogICAgICAgICAgICAgICAgZyA9IE1hdGgucm91bmQoKGcgKyBtKSAqIDI1NSk7CiAgICAgICAgICAgICAgICBiID0gTWF0aC5yb3VuZCgoYiArIG0pICogMjU1KTsKICAgICAgICAgICAgICAgIHJldHVybiBbciwgZywgYiwgYV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gcmdiYTJoc2xhKCkgewogICAgICAgICAgICAgICAgbGV0IHIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiUkMiKS52YWx1ZS8yNTU7CiAgICAgICAgICAgICAgICBsZXQgZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJHQyIpLnZhbHVlLzI1NTsKICAgICAgICAgICAgICAgIGxldCBiID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIkJDIikudmFsdWUvMjU1OwogICAgICAgICAgICAgICAgLy9kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYWxwaGFzbGlkZSIpLnZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIkFDIikudmFsdWU7CiAgICAgICAgICAgICAgICBhbHBoYSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJBQyIpLnZhbHVlLzI1NTsKCiAgICAgICAgICAgIC8vIEZpbmQgZ3JlYXRlc3QgYW5kIHNtYWxsZXN0IGNoYW5uZWwgdmFsdWVzCiAgICAgICAgICAgICAgICBsZXQgY21pbiA9IE1hdGgubWluKHIsZyxiKTsKICAgICAgICAgICAgICAgIGxldCBjbWF4ID0gTWF0aC5tYXgocixnLGIpOwogICAgICAgICAgICAgICAgbGV0IGRlbHRhID0gY21heCAtIGNtaW47CiAgICAgICAgICAgICAgICBsZXQgaCA9IDAsIHMgPSAwLCBsID0gMDsKICAgICAgICAgICAgICAgIGlmIChkZWx0YSA9PSAwKXsKICAgICAgICAgICAgICAgICAgICBoID0gMDsgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNtYXggPT0gcil7CiAgICAgICAgICAgICAgICAgICAgaCA9ICgoZyAtIGIpIC8gZGVsdGEpICUgNjsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY21heCA9PSBnKXsKICAgICAgICAgICAgICAgICAgICBoID0gKGIgLSByKSAvIGRlbHRhICsgMjsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaCA9IChyIC0gZykgLyBkZWx0YSArIDQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBoID0gaCAqIDYwOwogICAgICAgICAgICAgICAgaHVlID0gaDwwPyBoKzM2MCA6IGg7CgogICAgICAgICAgICAgICAgbCA9IChjbWF4ICsgY21pbikgLyAyOwoKICAgICAgICAgICAgICAgIHMgPSAoZGVsdGEgPT0gMCkgPyAwIDogZGVsdGEgLyAoMSAtIE1hdGguYWJzKDIgKiBsIC0gMSkpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2x4eVswXSA9ICsocyAqIDEwMCkgKiAyOwogICAgICAgICAgICAgICAgc2x4eVsxXSA9IDIwMCAtIChsICogMTAwKSAqIDI7CiAgICAgICAgICAgICAgICBuZXdGcmFtZSA9IHRydWU7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mKENlZlNoYXJwKSAhPSAidW5kZWZpbmVkIikgCiAgICAgICAgICAgICAgICAgICAgQ2VmU2hhcnAuUG9zdE1lc3NhZ2UoSlNPTi5zdHJpbmdpZnkoWzI1NSpyLCAyNTUqZywgMjU1KmIsIGFscGhhXSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUNhbnZhcygpewogICAgICAgICAgICAgICAgaWYgKHNseHlbMV0gPiAyMDApewogICAgICAgICAgICAgICAgICAgIHNseHlbMV0gPSAyMDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoc2x4eVsxXSA8IDApewogICAgICAgICAgICAgICAgICAgIHNseHlbMV0gPSAwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHNseHlbMF0gPiAyMDApewogICAgICAgICAgICAgICAgICAgIHNseHlbMF0gPSAyMDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoc2x4eVswXSA8IDApewogICAgICAgICAgICAgICAgICAgIHNseHlbMF0gPSAwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbGV0IGMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29sb3JzcXVhcmUiKTsKICAgICAgICAgICAgICAgIGxldCBoID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImh1ZXNlbCIpOwogICAgICAgICAgICAgICAgLy9hbHBoYSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhbHBoYXNsaWRlIikudmFsdWUvMjU1OwogICAgICAgICAgICAgICAgbGV0IHNxY3R4ID0gYy5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgICAgICAgICAgbGV0IGhjdHggPSBoLmdldENvbnRleHQoJzJkJyk7CiAgICAgICAgICAgICAgICBzcWN0eC5maWxsU3R5bGUgPSAiIzc3NyI7CiAgICAgICAgICAgICAgICBzcWN0eC5maWxsUmVjdCgwLCAwLCAyMDAsIDIwMCk7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaTwyMDsgaSsrKXsKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gLTEwOyBqPD0gMTA7IGorKyl7CiAgICAgICAgICAgICAgICAgICAgICAgIHNxY3R4LmZpbGxTdHlsZSA9ICIjY2JjYmNiIjsKICAgICAgICAgICAgICAgICAgICAgICAgc3FjdHguZmlsbFJlY3QoMTAqaSwgMTAqaS0yMCpqLCAxMCwgMTApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxldCBkZWx0YSA9IGh1ZSAtIHBodWU7CiAgICAgICAgICAgICAgICAvL3BodWUgPSBodWU7CiAgICAgICAgICAgICAgICBzcWN0eC5nbG9iYWxBbHBoYSA9IGFscGhhOwogICAgICAgICAgICAgICAgc3FjdHguZmlsdGVyID0gYGh1ZS1yb3RhdGUoJHtkZWx0YX1kZWcpYDsKICAgICAgICAgICAgICAgIHNxY3R4LmRyYXdJbWFnZShzbFFpbWFnZSwwLDApOwogICAgICAgICAgICAgICAgc3FjdHguZmlsdGVyID0gIm5vbmUiOwogICAgICAgICAgICAgICAgc3FjdHguZ2xvYmFsQWxwaGEgPSAxOwogICAgICAgICAgICAgICAgc3FjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgICAgICBzcWN0eC5zdHJva2VTdHlsZSA9ICIjMDAwIjsKICAgICAgICAgICAgICAgIHNxY3R4LmFyYyhzbHh5WzBdLCBzbHh5WzFdLCA0LCAwLCAyKk1hdGguUEkpOwogICAgICAgICAgICAgICAgc3FjdHguc3Ryb2tlKCk7CgogICAgICAgICAgICAgICAgaWYgKGFjRnJhbWUgfHwgTWF0aC5hYnMocGh1ZSAtIGh1ZSkgPiA2MCl7CiAgICAgICAgICAgICAgICAgICAgYWNGcmFtZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIC8vcGFscGhhID0gYWxwaGEKICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKGFjRnJhbWUpOwogICAgICAgICAgICAgICAgICAgIHBodWUgPSBodWU7CiAgICAgICAgICAgICAgICAgICAgbGV0IHZjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgICAgICAgICAgICAgdmMud2lkdGggPSB2Yy5oZWlnaHQgPSAyMDA7CiAgICAgICAgICAgICAgICAgICAgbGV0IHZjcmN0eCA9IHZjLmdldENvbnRleHQoJzJkJyk7CiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gMjAwOyBpKyspewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgZ3JhZGllbnQgPSBzcWN0eC5jcmVhdGVMaW5lYXJHcmFkaWVudCgwLCAyMDAtaSwgMjAwLCAyMDAtaSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGdyYWRpZW50LmFkZENvbG9yU3RvcCgwLGBoc2woJHtodWV9LCAwJSwgJHtpLzJ9JSlgKTsKICAgICAgICAgICAgICAgICAgICAgICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDEsYGhzbCgke2h1ZX0sIDEwMCUsICR7aS8yfSUpYCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZjcmN0eC5maWxsU3R5bGUgPSBncmFkaWVudDsKICAgICAgICAgICAgICAgICAgICAgICAgdmNyY3R4LmZpbGxSZWN0KDAsIDIwMC1pLCAyMDAsIDEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBzbFFpbWFnZS5zcmMgPSB2Yy50b0RhdGFVUkwoJ2ltYWdlL3BuZycpOwogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQodXBkYXRlQ2FudmFzLCAxMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGhjdHguZHJhd0ltYWdlKGh1ZWJhcmltYWdlLDAsMCk7CiAgICAgICAgICAgICAgICBoY3R4LmZpbGxTdHlsZSA9ICcjMDAwJzsKICAgICAgICAgICAgICAgIGhjdHguZmlsbFJlY3QoMjAwKihodWUvMzYwKSwwLDEsMjApOwogICAgICAgICAgICAgICAgbGV0IHJnYmEgPSBoc2xhMnJnYmEoaHVlLCBzbHh5WzBdLzIwMCwgKDIwMC1zbHh5WzFdKS8yMDAsIGFscGhhKTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJSQ1MiKS52YWx1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJSQyIpLnZhbHVlID0gcmdiYVswXTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJHQ1MiKS52YWx1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJHQyIpLnZhbHVlID0gcmdiYVsxXTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJCQ1MiKS52YWx1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJCQyIpLnZhbHVlID0gcmdiYVsyXTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJBQ1MiKS52YWx1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJBQyIpLnZhbHVlID0gTWF0aC5yb3VuZChyZ2JhWzNdKjI1NSk7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mKENlZlNoYXJwKSAhPSAidW5kZWZpbmVkIikgCiAgICAgICAgICAgICAgICAgICAgQ2VmU2hhcnAuUG9zdE1lc3NhZ2UoSlNPTi5zdHJpbmdpZnkocmdiYSkpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KHJnYmEpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBnZXRDdXJzb3JQb3NpdGlvbihjYW52YXMsIGV2ZW50KSB7OwogICAgICAgICAgICAgICAgY29uc3QgcmVjdCA9IGNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKQogICAgICAgICAgICAgICAgY29uc3QgeCA9IGV2ZW50LmNsaWVudFggLSByZWN0LmxlZnQ7CiAgICAgICAgICAgICAgICBjb25zdCB5ID0gZXZlbnQuY2xpZW50WSAtIHJlY3QudG9wOwogICAgICAgICAgICAgICAgcmV0dXJuIFt4LHldOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHdpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbigpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNzcXVhcmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjY29sb3JzcXVhcmUnKTsKICAgICAgICAgICAgICAgIGNzcXVhcmUuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgbW91c2Vkb3duID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBzbHh5ID0gZ2V0Q3Vyc29yUG9zaXRpb24oY3NxdWFyZSwgZSk7CiAgICAgICAgICAgICAgICAgICAgbmV3RnJhbWUgPSB0cnVlOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBjc3F1YXJlLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCAoKSA9PiBtb3VzZWRvd24gPSBmYWxzZSk7CiAgICAgICAgICAgICAgICBjc3F1YXJlLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIGUgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChtb3VzZWRvd24pewogICAgICAgICAgICAgICAgICAgICAgICBzbHh5ID0gZ2V0Q3Vyc29yUG9zaXRpb24oY3NxdWFyZSwgZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0ZyYW1lID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGNvbnN0IGh1ZXNlbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNodWVzZWwnKTsKICAgICAgICAgICAgICAgIGh1ZXNlbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBlID0+IHsKICAgICAgICAgICAgICAgICAgICBtb3VzZWRvd24gPSB0cnVlOyAKICAgICAgICAgICAgICAgICAgICBsZXQgeHkgPSBnZXRDdXJzb3JQb3NpdGlvbihodWVzZWwsIGUpOwogICAgICAgICAgICAgICAgICAgIGh1ZSA9ICh4eVswXS8yMDApKjM2MDsKICAgICAgICAgICAgICAgICAgICBuZXdGcmFtZSA9IHRydWU7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGh1ZXNlbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgKCkgPT4gbW91c2Vkb3duID0gZmFsc2UpOwogICAgICAgICAgICAgICAgaHVlc2VsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIGUgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChtb3VzZWRvd24pewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgeHkgPSBnZXRDdXJzb3JQb3NpdGlvbihodWVzZWwsIGUpOwogICAgICAgICAgICAgICAgICAgICAgICBodWUgPSAoeHlbMF0vMjAwKSozNjA7CiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0ZyYW1lID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGxldCBzbGlkZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbdHlwZT0icmFuZ2UiXScpOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzbGlkZXJzLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgICAgICAgICBzbGlkZXJzW2ldLnN0eWxlLndpZHRoID0gMTk4IC0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbdHlwZT0ibnVtYmVyIl0nKS5vZmZzZXRXaWR0aCAtIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2xhYmVsJykub2Zmc2V0V2lkdGg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsZXQgaCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJodWVzZWwiKTsKICAgICAgICAgICAgICAgIGxldCBoY3R4ID0gaC5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyMDA7IGkrKyl7CiAgICAgICAgICAgICAgICAgICAgaGN0eC5maWxsU3R5bGUgPSBgaHNsKCR7MzYwKigoaSsxKS8yMDApfSwgMTAwJSwgNTAlKWA7CiAgICAgICAgICAgICAgICAgICAgaGN0eC5maWxsUmVjdChpLDAsMSwyMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBodWViYXJpbWFnZSA9IG5ldyBJbWFnZTsKICAgICAgICAgICAgICAgIGh1ZWJhcmltYWdlLnNyYyA9IGgudG9EYXRhVVJMKCJpbWFnZS9wbmciKTsKCiAgICAgICAgICAgICAgICBsZXQgYyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb2xvcnNxdWFyZSIpOwogICAgICAgICAgICAgICAgbGV0IHNxY3R4ID0gYy5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gMjAwOyBpKyspewogICAgICAgICAgICAgICAgICAgIGxldCBncmFkaWVudCA9IHNxY3R4LmNyZWF0ZUxpbmVhckdyYWRpZW50KDAsIDIwMC1pLCAyMDAsIDIwMC1pKTsKICAgICAgICAgICAgICAgICAgICBncmFkaWVudC5hZGRDb2xvclN0b3AoMCxgaHNsYSgwLCAwJSwgJHtpLzJ9JSlgKTsKICAgICAgICAgICAgICAgICAgICBncmFkaWVudC5hZGRDb2xvclN0b3AoMSxgaHNsYSgwLCAxMDAlLCAke2kvMn0lKWApOwogICAgICAgICAgICAgICAgICAgIHNxY3R4LmZpbGxTdHlsZSA9IGdyYWRpZW50OwogICAgICAgICAgICAgICAgICAgIHNxY3R4LmZpbGxSZWN0KDAsIDIwMC1pLCAyMDAsIDEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc2xRaW1hZ2UgPSBuZXcgSW1hZ2U7CiAgICAgICAgICAgICAgICBzbFFpbWFnZS5zcmMgPSBjLnRvRGF0YVVSTCgiaW1hZ2UvcG5nIik7CgogICAgICAgICAgICAgICAgbmV3RnJhbWUgPSB0cnVlOwogICAgICAgICAgICAgICAgc2V0SW50ZXJ2YWwoZnJhbWUsIDEwMDAvMzApOwogICAgICAgICAgICAgICAgc2V0SW50ZXJ2YWwoKCk9PiB7bmV3RnJhbWUgPSAoTWF0aC5hYnMocGh1ZSAtIGh1ZSkgPiAxKTsgYWNGcmFtZSA9IHRydWV9LCA1MDApOwogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKT0+bmV3RnJhbWUgPSB0cnVlLCA2MDApOwogICAgICAgICAgICB9CiAgICAgICAgPC9zY3JpcHQ+CiAgICA8L2hlYWQ+CiAgICA8Ym9keT4KICAgICAgICA8Y2FudmFzIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBpZD0iY29sb3JzcXVhcmUiPjwvY2FudmFzPjxicj48YnI+CiAgICAgICAgPGNhbnZhcyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwIiBpZD0iaHVlc2VsIj48L2NhbnZhcz48YnI+CiAgICAgICAgPGxhYmVsPlI6Jm5ic3A7PC9sYWJlbD48aW5wdXQgdHlwZT0icmFuZ2UiIGlkPSJSQ1MiIG1pbj0iMCIgbWF4PSIyNTUiIHZhbHVlPSIyNTUiIG9uaW5wdXQ9ImRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdSQycpLnZhbHVlID0gdGhpcy52YWx1ZTtyZ2JhMmhzbGEoKTtuZXdGcmFtZSA9IHRydWU7Ii8+PGlucHV0IHR5cGU9Im51bWJlciIgdmFsdWU9IjI1NSIgbWluPTAgbWF4PTI1NSBpZD0iUkMiIGNsYXNzPSJDViIgb25jaGFuZ2U9InJnYmEyaHNsYSgpIj48YnI+CiAgICAgICAgPGxhYmVsPkc6Jm5ic3A7PC9sYWJlbD48aW5wdXQgdHlwZT0icmFuZ2UiIGlkPSJHQ1MiIG1pbj0iMCIgbWF4PSIyNTUiIHZhbHVlPSIyNTUiIG9uaW5wdXQ9ImRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdHQycpLnZhbHVlID0gdGhpcy52YWx1ZTtyZ2JhMmhzbGEoKTtuZXdGcmFtZSA9IHRydWU7Ii8+PGlucHV0IHR5cGU9Im51bWJlciIgdmFsdWU9IjI1NSIgbWluPTAgbWF4PTI1NSBpZD0iR0MiIGNsYXNzPSJDViIgb25jaGFuZ2U9InJnYmEyaHNsYSgpIj48YnI+CiAgICAgICAgPGxhYmVsPkI6Jm5ic3A7PC9sYWJlbD48aW5wdXQgdHlwZT0icmFuZ2UiIGlkPSJCQ1MiIG1pbj0iMCIgbWF4PSIyNTUiIHZhbHVlPSIyNTUiIG9uaW5wdXQ9ImRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdCQycpLnZhbHVlID0gdGhpcy52YWx1ZTtyZ2JhMmhzbGEoKTtuZXdGcmFtZSA9IHRydWU7Ii8+PGlucHV0IHR5cGU9Im51bWJlciIgdmFsdWU9IjI1NSIgbWluPTAgbWF4PTI1NSBpZD0iQkMiIGNsYXNzPSJDViIgb25jaGFuZ2U9InJnYmEyaHNsYSgpIj48YnI+CiAgICAgICAgPGxhYmVsPkE6Jm5ic3A7PC9sYWJlbD48aW5wdXQgdHlwZT0icmFuZ2UiIGlkPSJBQ1MiIG1pbj0iMCIgbWF4PSIyNTUiIHZhbHVlPSIyNTUiIG9uaW5wdXQ9ImRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdBQycpLnZhbHVlID0gdGhpcy52YWx1ZTtyZ2JhMmhzbGEoKTtuZXdGcmFtZSA9IHRydWU7Ii8+PGlucHV0IHR5cGU9Im51bWJlciIgdmFsdWU9IjI1NSIgbWluPTAgbWF4PTI1NSBpZD0iQUMiIGNsYXNzPSJDViIgb25jaGFuZ2U9InJnYmEyaHNsYSgpIj4KCiAgICA8L2JvZHk+ICAgIAo8L2h0bWw+" 
            JavascriptMessageReceived="browser_JavascriptMessageReceived"/>
    </Grid>
</Window>
